'use strict';

var vertigo = require('vertigo')();

vertigo
  .transport('jsonp', vertigo.jsonp)
  .transport('flash', vertigo.flash)
  .transport('xhr', vertigo.xhr)
  .transport('event-source', vertigo.eventsource)
  .transport('custom', require('custom-transport'))
  .transport('websocket', vertigo.websocket);

vertigo.transform('incoming', function incoming(msg, next) {
  setTimeout(function timeout() {
    msg.data = 'foo';
    next(undefined, false);
  });
});

vertigo.transform('incoming', 'event', function incoming(msg) {
  delete msg.data;
  return false;
});

vertigo.on('event', function event(msg) {
  console.log(msg);
});

vertigo.listen(8080);
